<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout - Chorki</title>
    <style>
      /* Copied styles from index.html for consistency */
      :root {
        --primary-color: #f8d56b;
        --secondary-color: #2c3e50;
        --light-color: #f9f9f9;
        --dark-color: #333;
        --success-color: #4caf50;
        --danger-color: #f44336;
      }
      * { margin: 0; padding: 0; box-sizing: border-box; font-family: poppins, sans-serif; }
      body { background-color: #fff; color: var(--dark-color); line-height: 1.6; }
      .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
      header { background-color: var(--light-color); box-shadow: 0 2px 5px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
      .header-container { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; }
      .logo { font-size: 28px; font-weight: bold; color: var(--secondary-color); text-decoration: none; }
      .nav-links { display: flex; list-style: none; }
      .nav-links li { margin-left: 30px; }
      .nav-links a { text-decoration: none; color: var(--dark-color); font-weight: 500; transition: color 0.3s; }
      .nav-links a:hover { color: var(--primary-color); }

      /* Checkout Page Specific Styles */
      .checkout-container {
        display: flex;
        flex-wrap: wrap;
        gap: 40px;
        padding: 40px 0;
      }
      .checkout-form, .checkout-summary {
        flex: 1;
        min-width: 320px;
      }
      .checkout-box {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 25px;
      }
      .checkout-title {
        font-size: 24px;
        color: var(--secondary-color);
        margin-bottom: 25px;
        border-bottom: 1px solid #eee;
        padding-bottom: 15px;
      }
      .form-group { margin-bottom: 20px; }
      .form-label { display: block; margin-bottom: 8px; font-weight: 500; }
      .form-input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
      .form-input::placeholder { color: #aaa; }
      .summary-item { display: flex; justify-content: space-between; margin-bottom: 15px; font-size: 16px; }
      .summary-product { display: flex; align-items: center; gap: 15px; }
      .summary-product img { width: 60px; height: 60px; object-fit: cover; border-radius: 5px; }
      .summary-product-info { font-size: 14px; }
      .summary-product-name { color: var(--secondary-color); }
      .summary-product-price { color: #888; }
      .summary-total { font-weight: bold; }
      .summary-divider { border-top: 1px solid #eee; margin: 20px 0; }
      .shipping-options label { display: flex; justify-content: space-between; padding: 12px; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; margin-bottom: 10px; }
      .shipping-options input { display: none; }
      .shipping-options input:checked + label { border-color: var(--primary-color); background-color: #fef8e6; }
      .cod-box { background-color: #f1f1f1; padding: 15px; border-radius: 5px; margin-top: 20px; font-size: 14px; text-align: center; }
      .btn-place-order {
        width: 100%;
        background-color: var(--success-color);
        color: white;
        padding: 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 18px;
        font-weight: bold;
        transition: background-color 0.3s;
        margin-top: 20px;
      }
      .btn-place-order:hover { background-color: #45a049; }
      .btn-place-order:disabled { background-color: #aaa; cursor: not-allowed; }
      .empty-cart-message { text-align: center; padding: 50px; font-size: 18px; color: #666;}
      .empty-cart-message a { color: var(--primary-color); font-weight: bold;}

      @media (max-width: 768px) {
        .checkout-container { flex-direction: column; }
      }
    </style>
</head>
<body>
    <header>
      <div class="container header-container">
        <a href="index.html" class="logo">
          <img src="riyad_logo-01.png" alt="logo" style="width: 100%; height: 35px" />
        </a>
        <ul class="nav-links">
            <li><a href="index.html#products">Continue Shopping</a></li>
        </ul>
      </div>
    </header>

    <main class="container">
      <div id="checkoutPage">
        <div class="checkout-container">
            <div class="checkout-form">
                <form id="customerOrderForm" class="checkout-box">
                    <h2 class="checkout-title">অর্ডার করতে ফর্মটি পূরণ করুন।</h2>
                    <div class="form-group">
                        <label for="name" class="form-label">আপনার নাম *</label>
                        <input type="text" id="name" class="form-input" placeholder="আপনার সম্পূর্ণ নাম লিখুন" required />
                    </div>
                    <div class="form-group">
                        <label for="phone" class="form-label">আপনার মোবাইল নাম্বারটি দিন *</label>
                        <input type="tel" id="phone" class="form-input" placeholder="একটি সচল মোবাইল নাম্বার দিন" required />
                    </div>
                    <div class="form-group">
                        <label for="address" class="form-label">আপনার ঠিকানা দিন *</label>
                        <input type="text" id="address" class="form-input" placeholder="গ্রাম, থানা, জেলা" required />
                    </div>
                     <div class="form-group">
                        <label for="note" class="form-label">বিশেষ নির্দেশনা (ঐচ্ছিক)</label>
                        <textarea id="note" class="form-input" placeholder="আপনার কোনো বিশেষ নির্দেশনা থাকলে এখানে লিখুন"></textarea>
                    </div>
                </form>
            </div>

            <div class="checkout-summary">
                <div class="checkout-box">
                    <h2 class="checkout-title">আপনার অর্ডার</h2>
                    <div id="summaryItems"></div>
                    <div class="summary-divider"></div>
                    <div class="summary-item">
                        <span>Subtotal</span>
                        <span id="summarySubtotal">0.00৳</span>
                    </div>
                    <div class="shipping-options" id="shippingOptions">
                         <h3 style="margin-bottom: 10px; font-size: 16px; color: var(--secondary-color);">Shipping</h3>
                         <input type="radio" id="shipping_dhaka" name="shipping" value="70" required>
                         <label for="shipping_dhaka">
                           <span>ঢাকার সিটির মধ্যে</span>
                           <span>70.00৳</span>
                         </label>
                         <input type="radio" id="shipping_outside" name="shipping" value="120">
                         <label for="shipping_outside">
                           <span>ঢাকার বাহিরে</span>
                           <span>120.00৳</span>
                         </label>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-item summary-total">
                        <span>Total</span>
                        <span id="summaryTotal">0.00৳</span>
                    </div>
                    <div class="cod-box">
                        Cash on delivery (ক্যাশ অন ডেলিভারি)
                    </div>
                    <button type="submit" form="customerOrderForm" class="btn-place-order" id="btnPlaceOrder">আপনার অর্ডার কনফার্ম করতে ক্লিক করুন</button>
                </div>
            </div>
        </div>
      </div>
      <div id="confirmationPage" style="display:none; text-align: center; padding: 50px;">
          <div style="font-size: 60px; color: var(--success-color);">✓</div>
          <h2 style="font-size: 28px; color: var(--secondary-color); margin: 20px 0;">Order Confirmed!</h2>
          <p style="font-size: 16px; color: #666; margin-bottom: 30px;">Thank you for your purchase. Your order has been placed successfully.</p>
          <a href="index.html" style="display: inline-block; background-color: var(--primary-color); color: var(--secondary-color); padding: 12px 30px; border-radius: 5px; text-decoration: none; font-weight: bold;">Continue Shopping</a>
      </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const checkoutPage = document.getElementById('checkoutPage');

            if (cart.length === 0 && !window.location.search.includes('order_confirmed')) {
                 checkoutPage.innerHTML = `<div class="empty-cart-message">
                    <p>Your cart is empty.</p>
                    <a href="index.html">Go back to shopping</a>
                </div>`;
                return;
            }

            const summaryItemsEl = document.getElementById('summaryItems');
            const summarySubtotalEl = document.getElementById('summarySubtotal');
            const summaryTotalEl = document.getElementById('summaryTotal');
            const shippingOptions = document.querySelectorAll('input[name="shipping"]');
            const orderForm = document.getElementById('customerOrderForm');
            const confirmationPage = document.getElementById('confirmationPage');
            const placeOrderBtn = document.getElementById('btnPlaceOrder');

            const formatPrice = (price) => {
                 return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'BDT', minimumFractionDigits: 2 }).format(price).replace('BDT', '') + '৳';
            };

            const renderSummary = () => {
                summaryItemsEl.innerHTML = '';
                let subtotal = 0;
                cart.forEach(item => {
                    subtotal += item.price * item.quantity;
                    summaryItemsEl.innerHTML += `
                        <div class="summary-item summary-product">
                            <img src="${item.image}" alt="${item.name}">
                            <div class="summary-product-info">
                                <div class="summary-product-name">${item.name} (x${item.quantity})</div>
                            </div>
                            <span class="summary-product-price">${formatPrice(item.price * item.quantity)}</span>
                        </div>
                    `;
                });
                
                summarySubtotalEl.textContent = formatPrice(subtotal);
                updateTotal();
            };

            const updateTotal = () => {
                const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                const selectedShipping = document.querySelector('input[name="shipping"]:checked');
                const shippingCost = selectedShipping ? parseFloat(selectedShipping.value) : 0;
                
                const total = subtotal + shippingCost;
                summaryTotalEl.textContent = formatPrice(total);

                placeOrderBtn.disabled = !selectedShipping;
            };

            shippingOptions.forEach(option => {
                option.addEventListener('change', updateTotal);
            });

            orderForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const customer = {
                    name: document.getElementById('name').value,
                    phone: document.getElementById('phone').value,
                    address: document.getElementById('address').value,
                    note: document.getElementById('note').value,
                };
                
                const subtotal = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                const shippingCost = parseFloat(document.querySelector('input[name="shipping"]:checked').value);

                const order = {
                    id: Date.now(),
                    date: new Date().toLocaleString('en-US', { timeZone: 'Asia/Dhaka' }),
                    customer,
                    items: cart,
                    subtotal,
                    shippingCost,
                    total: subtotal + shippingCost,
                    payment: 'Cash on Delivery'
                };
                
                if (window.saveOrderToFirestore) {
                    saveOrderToFirestore(order);
                } else {
                    console.error("Firebase save function not found. Order not saved to database.");
                }

                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                orders.push(order);
                localStorage.setItem('orders', JSON.stringify(orders));

                localStorage.removeItem('cart');

                checkoutPage.style.display = 'none';
                confirmationPage.style.display = 'block';
            });
            
            renderSummary();
            updateTotal();
        });
    </script>
    
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";

      const firebaseConfig = {
        apiKey: "AIzaSyA7kF4VrKR8-w34rQNcxzyp3HKPvpxJxnc",
        authDomain: "chorki-cf140.firebaseapp.com",
        projectId: "chorki-cf140",
        storageBucket: "chorki-cf140.firebasestorage.app",
        messagingSenderId: "696220681851",
        appId: "1:696220681851:web:8165a71a385db381b3c4de",
        measurementId: "G-YMCF34T1E4"
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      window.firebaseApp = app;
    </script>

    <script>
      import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js").then(({ getFirestore, collection, addDoc }) => {
        const db = getFirestore(window.firebaseApp);
        window.saveOrderToFirestore = async function(order) {
          try {
            await addDoc(collection(db, "orders"), order);
            console.log("✅ Order saved to Firestore!");
          } catch (e) {
            console.error("❌ Error saving order to Firestore: ", e);
          }
        };
      });
    </script>
</body>
</html>